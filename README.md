[![General Assembly Logo](https://camo.githubusercontent.com/1a91b05b8f4d44b5bbfb83abac2b0996d8e26c92/687474703a2f2f692e696d6775722e636f6d2f6b6538555354712e706e67)](https://generalassemb.ly/education/web-development-immersive)


# Capstone - Ongline NFL Draft List - API


NFL fantasy draft list to prepare for draft day!
- Backend express/mongodb
- 8 tables total
- Full CRUD on users and Draft, and others are READ only

ERD was made for Rails but decided on API to be express/mongodb since I
already built Rails on my project2 and did not work with express/mongodb as much
in project3.  Also it made more sense to make this a express/mongodb since the
6 data tables should be access to everyone and did not need to be relation at all.
And all data for the other 6 tables aside from User and Draft are imports of
CSV files.


# URL's
- Client
  - Repo: https://github.com/Ryaong792/OnglineNFLDraftList
  - Deployed: https://ryaong792.github.io/OnglineNFLDraftList/
- Backend(API)
  - Repo: https://github.com/Ryaong792/OngLineNFLDraftListAPI
  - Deployed: https://onglinenfldraftlist.herokuapp.com

![ERD](/ERD.png)


# API routes
- Users (CRUD)
- QB (Read only)
- TE (Read only)
- WR (Read only)
- RB (Read Only)
- K (Read Only)
- DST (Read Only)
- Draft (CRUD)

# Approach of the Project

- Creation of ERD
- Downloaded express template and deploy
- Creation of models Read Only - then inport Data through CSV to the following:
    - QB, TE, WR, RB, K, DST,
- Downloaded Robomongo - to be able view current DB that was uploaded
- Creation of Controllers for Read Only
- Creation of Draft models and controller for FULL CRUD.
- Tested with postman and confirmed with test.html with buttons to make sure that
  Data was passing through ok.
- create mongodb files for deploy
- Deploy API on heroku

# Reflections and Lessons Learned

## Issues
  - Had problems trying to make mongo a relation database since I wanted
    Users to only have one draft but many players of each position.  Was able to
    resolve this by not forcing a relatation database base on ERD and decided
    to make Draft to create players instead.  That way users log in just create
    players and can still feel like a one to one relationship of the draft table.

  - Issues with only having users add one unique player on a list.  Since mongo
    was un-relatational it was hard to make it only add one type of player without
    doing alot of JS code for it to limit the section.  Was able to resolve this issue
    by installing the NPM mongoose-unique-validator.  After installing was able to add
    unique field as required.  Created a playerID field in draft.  And by the use of
    handlebars and store feature was able to add playerid with user-login and _id of
    the player object and creating a unique playerid base on user login.  This resolved
    the issue in regards users only able to add one unique player while others log in
    can still add the same player.

## Overall
  - Creation of the API was not as hard as I thought it would be.  Planned well
    ahead and made sure that the API matches what I would need for my ERD.  Learned
    alot by able to check for NPM plugins to help resolve issues that was already been
    thought of.  

## Dependencies

Install with `npm install`.

-   [`express`](http://expressjs.com/)
-   [`mongoose`](http://mongoosejs.com/)
-   [`mongoose-unique-validator`](https://www.npmjs.com/package/mongoose-unique-validator)

At the beginning of each cohort, update the versions in
[`package.json`](package.json) by replace all versions with a glob (`*`) and
running `npm update --save && npm update --save-dev`. You may wish to test these
changes by deleting the `node_modules` directory and running `npm install`.
Fix any conflicts.

## Installation

1.  Clone this repo
1.  Set a SECRET_KEY in the environment.
  - For development and testing, set the SECRET_KEY from the root of your
   repository using

  ```sh
  echo SECRET_KEY=$(/usr/local/opt/openssl/bin/openssl rand -base64 66 | tr -d '\n') >>.env
  ```
1.  Run the API server with `nodemon`.

In order to make requests from your deployed client application, you will need
to set `CLIENT_ORIGIN` in the environment (e.g. `heroku config:set
CLIENT_ORIGIN=https://<github-username>.github.io`).
1. Add STRIPE_SECRET_KEY using the SK for your personal stripe account

## Structure

Dependencies are stored in [`package.json`](package.json).

Do not configure `grunt` packages directly in the
[`Gruntfile.js`](Gruntfile.js). Instead, store configurations in the
[`grunt`](grunt) directory. You won't need a top-level key, since that's
generated by the `Gruntfile.js` based on the filename of the configuration
object stored in the `grunt` directory.

Developers should store JavaScript files in [`app/controllers`](app/controllers)
 and [`app/models`](app/models).
Routes are stored in [`config/routes.js`](config/routes.js)

## Tasks

Developers should run these often!

-   `grunt nag` or just `grunt`: runs code quality analysis tools on your code
    and complains
-   `grunt reformat`: reformats all your code in a standard style
-   `grunt test`: runs any automated tests

## API

Use this as the basis for your own API documentation. Add a new third-level
heading for your custom entities, and follow the pattern provided for the
built-in user authentication documentation.

Scripts are included in [`scripts`](scripts) to test built-in actions. Add your
own scripts to test your custom API.

### Authentication

| Verb   | URI Pattern            | Controller#Action |
|--------|------------------------|-------------------|
| POST   | `/sign-up`             | `users#signup`    |
| POST   | `/sign-in`             | `users#signin`    |
| PATCH  | `/change-password/:id` | `users#changepw`  |
| DELETE | `/sign-out/:id`        | `users#signout`   |

#### POST /sign-up

Request:

```sh
curl --include --request POST http://localhost:4741/sign-up \
  --header "Content-Type: application/json" \
  --data '{
    "credentials": {
      "email": "an@example.email",
      "password": "an example password",
      "password_confirmation": "an example password"
    }
  }'
```

```sh
scripts/sign-up.sh
```

Response:

```md
HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8

{
  "user": {
    "id": 1,
    "email": "an@example.email"
  }
}
```

#### POST /sign-in

Request:

```sh
curl --include --request POST http://localhost:4741/sign-in \
  --header "Content-Type: application/json" \
  --data '{
    "credentials": {
      "email": "an@example.email",
      "password": "an example password"
    }
  }'
```

```sh
scripts/sign-in.sh
```

Response:

```md
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8

{
  "user": {
    "id": 1,
    "email": "an@example.email",
    "token": "33ad6372f795694b333ec5f329ebeaaa"
  }
}
```

#### PATCH /change-password/:id

Request:

```sh
curl --include --request PATCH http://localhost:4741/change-password/$ID \
  --header "Authorization: Token token=$TOKEN" \
  --header "Content-Type: application/json" \
  --data '{
    "passwords": {
      "old": "an example password",
      "new": "super sekrit"
    }
  }'
```

```sh
ID=1 TOKEN=33ad6372f795694b333ec5f329ebeaaa scripts/change-password.sh
```

Response:

```md
HTTP/1.1 204 No Content
```

#### DELETE /sign-out/:id

Request:

```sh
curl --include --request DELETE http://localhost:4741/sign-out/$ID \
  --header "Authorization: Token token=$TOKEN"
```

```sh
ID=1 TOKEN=33ad6372f795694b333ec5f329ebeaaa scripts/sign-out.sh
```

Response:

```md
HTTP/1.1 204 No Content
```

### Users

| Verb | URI Pattern | Controller#Action |
|------|-------------|-------------------|
| GET  | `/users`    | `users#index`     |
| GET  | `/users/1`  | `users#show`      |

#### GET /users

Request:

```sh
curl --include --request GET http://localhost:4741/users \
  --header "Authorization: Token token=$TOKEN"
```

```sh
TOKEN=33ad6372f795694b333ec5f329ebeaaa scripts/users.sh
```

Response:

```md
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8

{
  "users": [
    {
      "id": 2,
      "email": "another@example.email"
    },
    {
      "id": 1,
      "email": "an@example.email"
    }
  ]
}
```

#### GET /users/:id

Request:

```sh
curl --include --request GET http://localhost:4741/users/$ID \
  --header "Authorization: Token token=$TOKEN"
```

```sh
ID=2 TOKEN=33ad6372f795694b333ec5f329ebeaaa scripts/user.sh
```

Response:

```md
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8

{
  "user": {
    "id": 2,
    "email": "another@example.email"
  }
}
```

### Products

| Verb   | URI Pattern            | Controller#Action |
|--------|------------------------|-------------------|
| GET    | `/products`            | `products#index`  |
| GET    | `/products/1`          | `products#show`   |

### Carts

| Verb   | URI Pattern            | Controller#Action |
|--------|------------------------|-------------------|
| GET    | `/carts`               | `carts#index`     |
| GET    | `/carts/1`             | `carts#show`      |
| POST   | `/carts`               | `carts#create`    |
| DELETE | `/carts/1`             | `carts#destroy`   |
| UPDATE | `/carts/1`             | `carts#update`    |

### Orders

| Verb   | URI Pattern            | Controller#Action |
|--------|------------------------|-------------------|
| GET    | `/orders`              | `orders#index`    |
| GET    | `/orders/1`            | `orders#show`     |
| POST   | `/orders/`             | `orders#create`   |

## [License](LICENSE)

1.  All content is licensed under a CC­BY­NC­SA 4.0 license.
1.  All software code is licensed under GNU GPLv3. For commercial use or
    alternative licensing, please contact legal@ga.co.
